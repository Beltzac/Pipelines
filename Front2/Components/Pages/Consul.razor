@page "/consul"
@inject ISignalRClientService SignalRClientService
@using Common
@using Common.Services
@using Markdig
@using Microsoft.AspNetCore.Components.Forms
@using System.Text.RegularExpressions
@using System.Reactive.Subjects
@using System.Reactive.Linq
@inject IToastService toastService
@rendermode InteractiveServer
@inject IJSRuntime JS
@inject IConsulService ConsulService
@inject ICommitDataExportService CommitDataExportService


<h3>Consul</h3>

<div class="mb-3">
    <label for="consulEditor" class="form-label">Consul Editor</label>
    <div>
        @foreach (var kvp in consulKeyValues)
        {
            <div>
                <strong>@kvp.Key:</strong>
                <pre>@kvp.Value</pre>
            </div>
        }
    </div>
</div>

<button class="btn btn-primary text-nowrap" @onclick="async () => await DownloadConsul()">Download Consul</button>
<button class="btn btn-success text-nowrap" @onclick="async () => await SaveConsul()">Save Consul</button>



@code {

    private async ValueTask DownloadConsul()
    {
        consulKeyValues = await ConsulService.GetConsulKeyValues();
        toastService.ShowSuccess("Consul key-values downloaded successfully!");
    }
    private Dictionary<string, string> consulKeyValues = new Dictionary<string, string>();
    private string consulContent = string.Empty;

    private async Task SaveConsul()
    {
        // Logic to save the edited Consul content
        // This is a placeholder for the actual implementation
        toastService.ShowSuccess("Consul content saved successfully!");
    }
}
